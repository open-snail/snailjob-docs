---
title: ç»„é…ç½®
date: 2023-07-30 11:05:41
permalink: /pages/32e4a0/
---

## ç»„æ˜¯ä½•ç‰©
> ä»…æ”¯æŒä»…æ”¯æŒæ•°å­—å­—æ¯ä¸‹åˆ’çº¿ä¸”æœ€å¤š64ä¸ªå­—ç¬¦ç»„æˆ

ç»„æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå®ƒå¯ä»¥è¢«è§†ä¸ºåœºæ™¯çš„åˆ†ç±»æˆ–æ ‡ç­¾ï¼Œç”¨äºå°†ä¸€äº›ç›¸å…³æ€§çš„åœºæ™¯è¿›è¡Œåˆ†ç»„ã€‚ç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ä¸­çš„Topicå’ŒQueueçš„å…³ç³»ï¼Œç»„åœ¨æŸç§ç¨‹åº¦ä¸Šå¯ä»¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚
åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒTopicç”¨äºå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå°†æ¶ˆæ¯å‘å¸ƒåˆ°ç›¸åº”çš„ä¸»é¢˜ï¼Œè€ŒQueueç”¨äºç‚¹å¯¹ç‚¹æ¨¡å¼ï¼Œæ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­è¢«æ¶ˆè´¹ã€‚ç±»ä¼¼åœ°ï¼Œç»„å¯ä»¥ç”¨äºå°†ä¸åŒåœºæ™¯æˆ–ä»»åŠ¡è¿›è¡Œé€»è¾‘åˆ†ç±»ï¼Œä»è€Œå®ç°æ›´å¥½çš„ç»„ç»‡å’Œç®¡ç†ã€‚
åœ¨æœåŠ¡ç«¯çš„[ç»„è´Ÿè½½å‡è¡¡å™¨](/pages/540554/#ç»„è´Ÿè½½å‡è¡¡å™¨)ä¸­ï¼Œä¹Ÿä½¿ç”¨äº†ç»„çš„æ¦‚å¿µã€‚å®ƒå°†ä¸åŒçš„ç»„åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡ç«¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹ã€‚è¿™ç§åˆ†ç»„å¯ä»¥ä½¿å¾—ä¸åŒçš„åœºæ™¯æˆ–ä»»åŠ¡åœ¨æœåŠ¡ç«¯å¾—åˆ°é€‚å½“çš„åˆ†é…å’Œå¤„ç†ï¼Œæé«˜äº†æ•´ä½“ç³»ç»Ÿçš„è´Ÿè½½å‡è¡¡æ€§èƒ½å’Œæ•ˆç‡ã€‚
é€šè¿‡ä½¿ç”¨ç»„ï¼Œå¯ä»¥æ›´å¥½åœ°ç®¡ç†å’Œç»„ç»‡åœºæ™¯ï¼Œå°†ç›¸å…³æ€§è¾ƒé«˜çš„åœºæ™¯èšé›†åœ¨ä¸€èµ·ï¼Œä¾¿äºç³»ç»Ÿçš„ç®¡ç†å’Œè¿ç»´ã€‚åŒæ—¶ï¼Œç»„ä¹Ÿä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›äº†æ›´å¥½çš„è´Ÿè½½å‡è¡¡å’Œèµ„æºåˆ†é…æ–¹å¼ï¼Œç¡®ä¿ä¸åŒåœºæ™¯æˆ–ä»»åŠ¡å¾—åˆ°åˆç†çš„å¤„ç†ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

## ä»€ä¹ˆæ˜¯ç»„çŠ¶æ€
> ç»„çŠ¶æ€æ§åˆ¶ç»„çš„å¯ç”¨å’Œåœæ­¢ã€‚
1. çŠ¶æ€æ˜¯å…³é—­æˆ–è€…å¼€å§‹éƒ½æ˜¯å…è®¸æ•°æ®çš„ä¸ŠæŠ¥
2. çŠ¶æ€æ˜¯å…³é—­ä¸ä¼šå‚ä¸[ç»„è´Ÿè½½å‡è¡¡å™¨](/pages/540554/#ç»„è´Ÿè½½å‡è¡¡å™¨)çš„åˆ†é…
3. ç”±å…³é—­->æ‰“å¼€æˆ–è€…ç”±æ‰“å¼€->å…³é—­éƒ½ä¼šè§¦å‘ç»„è´Ÿè½½å‡è¡¡å™¨çš„rebalanceæœºåˆ¶
4. çŠ¶æ€æ˜¯å…³é—­ä¸å¯¹æ‰«æè¯¥ç»„çš„ä»»ä½•ä»»åŠ¡

## ä»€ä¹ˆæ˜¯è·¯ç”±ç­–ç•¥
> å®¢æˆ·ç«¯ä¸ºé›†ç¾¤æ¨¡å¼æ—¶ï¼Œåœ¨ä¸‹å‘é‡è¯•æµé‡æ—¶éœ€è¦æ ¹æ®è·¯ç”±ç­–ç•¥åŒ¹é…ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œå…·ä½“çš„é‡è¯•ä»»åŠ¡æˆ–è€…å›è°ƒä»»åŠ¡. æ›´å¤šåŠŸèƒ½å¯å‚è€ƒ[é€šä¿¡æ¨¡å—](/pages/540554/#é€šä¿¡æ¨¡å—)

**ç›®å‰æ”¯æŒä¸‰ç§ç®—æ³•(åæœŸæ ¹æ®éœ€æ±‚å°†ç»§ç»­æ‰©å±•)**
- ä¸€è‡´æ€§Hashç®—æ³•
- LRUç®—æ³•
- éšæœºç®—æ³•

## ä»€ä¹ˆæ˜¯åˆ†åŒº
> easy retry é‡‡ç”¨äº†åˆ†è¡¨çš„æ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥æ”¯æ’‘æ›´å¤šçš„æ•°æ®æé«˜ç³»ç»Ÿçš„é«˜æ€§èƒ½å’Œå¯ç”¨æ€§

å…¶ä¸­retry_task_{0~N-1}å’Œretry_dead_letter_{0~N-1}é‡‡ç”¨åˆ†è¡¨ç­–ç•¥ï¼Œ
åˆ†åŒºæ€»æ•°é…ç½®å¦‚ä¸‹

<code-group>
  <code-block title="yamlé£æ ¼" active>

```yaml
easy-retry:
  total-partition: N  # é‡è¯•å’Œæ­»ä¿¡è¡¨çš„åˆ†åŒºæ€»æ•°
```
  </code-block>

  <code-block title="propertiesé£æ ¼">

```java
easy-retry.total-partition: N  # é‡è¯•å’Œæ­»ä¿¡è¡¨çš„åˆ†åŒºæ€»æ•°
```
  </code-block>
</code-group>

::: warning ğŸŒˆç‰¹åˆ«è¯´æ˜
1. Easy Retryä¸æ”¯æŒè‡ªåŠ¨å»ºè¡¨åŠŸèƒ½ï¼Œè‹¥æ˜¯æŒ‡å®šåˆ†åŒºçš„è¡¨ä¸å­˜åœ¨åˆ™ä¸èƒ½ä¿å­˜æˆåŠŸ. å› æ­¤åœ¨æ­å»ºç³»ç»Ÿæ—¶åº”åˆå§‹åŒ–å¥½ç›¸å…³çš„è¡¨ç»“æ„.
2. è‹¥ä¸æŒ‡å®šåˆ†åŒºåˆ™ç”±ç³»ç»Ÿé»˜è®¤åˆ†é…ä¸€ä¸ªåˆ†åŒºï¼Œæ”¯æŒå˜æ›´åˆ†åŒº.
3. åˆ†åŒºä¸€æ—¦å˜æ›´åï¼ŒåŸæœ¬åˆ†åŒºå†…çš„æ•°æ®å°†ä¸åœ¨è¿›è¡Œå¤„ç†.
:::


## ä»€ä¹ˆæ˜¯idç”Ÿæˆæ¨¡å¼
> ç”±äºeasy retryæ˜¯åˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œä»»åŠ¡è¡¨ä¹Ÿæ˜¯é‡‡ç”¨åˆ†è¡¨æ¨¡å¼ï¼Œæ‰€ä»¥ä¸ºäº†æ›´å¥½çš„æ ‡è®°é‡è¯•ä»»åŠ¡çš„å”¯ä¸€æ€§ï¼Œeasy retryä½¿ç”¨ä¸šå†…æ¯”è¾ƒæˆç†Ÿçš„åˆ†å¸ƒå¼idç”Ÿæˆç®—æ³•ç”ŸæˆuniqueId

**ç›®å‰æ”¯æŒä¸€ä¸‹idç”Ÿæˆç®—æ³•**
- å·æ®µæ¨¡å¼: é‡‡ç”¨ä¸šç•Œæˆç†Ÿçš„[ç¾å›¢å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆå™¨(leaf)](https://github.com/Meituan-Dianping/Leaf/blob/master/leaf-core/src/main/java/com/sankuai/inf/leaf/segment/SegmentIDGenImpl.java)çš„å·æ®µæ¨¡å¼ <br />
- é›ªèŠ±ç®—æ³•: ä½¿ç”¨hutoolè‡ªå¸¦çš„é›ªèŠ±ç®—æ³•ç”Ÿæˆidï¼Œè‹¥å‡ºç°æ—¶é—´å›æ‹¨é—®é¢˜åˆ™ç›´æ¥æŠ¥é”™

## ä»€ä¹ˆæ˜¯åˆå§‹åŒ–åœºæ™¯
> ä¸ºäº†æ›´ç®€å•æ–¹ä¾¿çš„ä½¿ç”¨EasyRetryï¼Œæˆ‘ä»¬æ”¯æŒäº†åœºæ™¯é»˜è®¤åˆå§‹åŒ–åŠŸèƒ½.
- è‹¥é€‰æ‹©ã€æ˜¯ã€‘:å½“æœªæŸ¥è¯¢åˆ°åœºæ™¯æ—¶é»˜è®¤ç”Ÿæˆä¸€ä¸ªåœºæ™¯(é€€é¿ç­–ç•¥: ç­‰çº§ç­–ç•¥, æœ€å¤§é‡è¯•æ¬¡æ•°: 21);
- è‹¥é€‰æ‹©ã€å¦ã€‘:æ–°å¢åœºæ™¯æ—¶å¿…é¡»å…ˆé…ç½®åœºæ™¯,å¦åˆ™ä¸ŠæŠ¥å¤±è´¥

